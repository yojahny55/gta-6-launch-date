<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTA 6 Launch Date Prediction Tracker</title>
  <meta name="description" content="Community-driven predictions for GTA 6 launch date. Submit your prediction and see what others think!">
  <link rel="stylesheet" href="/styles.built.css">

  <!-- Cloudflare Turnstile (Story 2.5B) -->
  <!-- Load asynchronously to avoid blocking page load -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body class="min-h-screen bg-base-200">
  <div id="app" class="container mx-auto px-4 py-8 max-w-2xl">
    <!-- Headline Section (AC1: Above-the-fold) -->
    <header class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-base-content mb-3">
        When Will GTA 6 Actually Launch?
      </h1>
      <p class="text-base md:text-lg text-base-content/70">
        Rockstar says <span class="font-semibold text-primary">November 19, 2026</span>. What does the community think?
      </p>
    </header>

    <!-- Stats Display Section (AC2: Community Statistics - largest element) -->
    <section id="stats-display" class="mb-8" aria-labelledby="stats-heading" aria-live="polite">
      <h2 id="stats-heading" class="sr-only">Community Prediction Statistics</h2>

      <!-- Loading Skeleton State -->
      <div id="stats-loading" class="card bg-base-100 shadow-xl">
        <div class="card-body items-center text-center animate-pulse">
          <div class="h-4 bg-base-300 rounded w-32 mb-4"></div>
          <div class="h-16 bg-base-300 rounded w-48 mb-4"></div>
          <div class="h-4 bg-base-300 rounded w-40 mb-2"></div>
          <div class="h-3 bg-base-300 rounded w-56"></div>
        </div>
      </div>

      <!-- Stats Content (hidden until loaded) -->
      <div id="stats-content" class="hidden card bg-base-100 shadow-xl">
        <div class="card-body items-center text-center">
          <p class="text-sm uppercase tracking-wider text-base-content/60 mb-2">Community Median Prediction</p>
          <!-- Median: LARGEST element (AC4: 2-3x normal text) -->
          <p id="stats-median" class="text-4xl md:text-5xl lg:text-6xl font-bold text-primary font-mono tabular-nums" aria-label="Community median prediction date">
            --
          </p>
          <!-- Total count with commas (AC2) -->
          <p id="stats-count" class="text-lg text-base-content/80 mt-2">
            <span id="stats-count-value" class="font-semibold">--</span> predictions
          </p>
          <!-- Min/Max range (AC4: tertiary information) -->
          <p id="stats-range" class="text-sm text-base-content/50 mt-1">
            Earliest: <span id="stats-min">--</span> | Latest: <span id="stats-max">--</span>
          </p>
        </div>
      </div>

      <!-- Threshold Message (AC: FR99 - count < 50) -->
      <div id="stats-threshold" class="hidden card bg-base-100 shadow-xl">
        <div class="card-body items-center text-center">
          <p class="text-lg text-base-content/80 mb-2">
            Need <span class="font-semibold">50 predictions</span> to show community median.
          </p>
          <p class="text-base-content/60">Be one of the first!</p>
          <p id="stats-threshold-progress" class="text-sm text-primary font-semibold mt-2">
            <span id="stats-threshold-count">--</span> / 50 predictions submitted
          </p>
        </div>
      </div>

      <!-- Error State (AC: FR59 - graceful error handling) -->
      <div id="stats-error" class="hidden card bg-error/10 shadow-xl border border-error/20">
        <div class="card-body items-center text-center">
          <svg class="w-12 h-12 text-error mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
          <p id="stats-error-message" class="text-error font-medium">Unable to load statistics</p>
          <button id="stats-retry-btn" class="btn btn-outline btn-error btn-sm mt-3" aria-label="Retry loading statistics">
            Try Again
          </button>
        </div>
      </div>
    </section>

    <!-- Chart Visualization Section (Story 3.4: Optional Chart Visualization Toggle) -->
    <!-- AC: Hidden by default (FR19), toggle button visible -->
    <!-- POSITIONING: Above prediction form as specified in Task 1d -->
    <section id="chart-section" class="mb-8" aria-labelledby="chart-heading">
      <h2 id="chart-heading" class="sr-only">Prediction Distribution Chart</h2>

      <!-- Toggle Button (AC: Visible, triggers chart display) -->
      <div class="text-center mb-4">
        <button
          id="chart-toggle-btn"
          type="button"
          class="btn btn-outline btn-primary"
          aria-expanded="false"
          aria-controls="chart-container"
          aria-label="Show prediction distribution chart"
        >
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span id="chart-toggle-text">Show Prediction Distribution</span>
        </button>
      </div>

      <!-- Chart Container (AC: Collapsed by default, expands on toggle) -->
      <div id="chart-container" class="hidden" role="region" aria-live="polite" aria-label="Prediction distribution histogram">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <!-- Loading Indicator (AC: Shown while Chart.js loads) -->
            <div id="chart-loading" class="text-center py-8">
              <div class="loading loading-spinner loading-lg text-primary"></div>
              <p class="text-sm text-base-content/60 mt-2">Loading chart...</p>
            </div>

            <!-- Chart Canvas (AC: Rendered by Chart.js) -->
            <canvas id="prediction-chart" class="hidden" aria-label="Histogram showing distribution of community predictions over time"></canvas>

            <!-- Accessible Data Table (AC: Alternative for screen readers) -->
            <div id="chart-data-table" class="sr-only" role="table" aria-label="Prediction distribution data table">
              <!-- Table will be populated dynamically -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Prediction Form Section (AC3: Primary CTA, visible above-the-fold) -->
    <section class="mb-8" aria-labelledby="form-heading">
      <h2 id="form-heading" class="sr-only">Submit Your Prediction</h2>

      <form id="prediction-form" class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="form-control w-full">
            <label for="predicted-date" class="label">
              <span class="label-text text-lg font-medium">When do you think GTA 6 will launch?</span>
            </label>
            <input
              type="date"
              id="predicted-date"
              name="predicted-date"
              class="input input-bordered w-full text-base"
              min="2025-01-01"
              max="2125-12-31"
              required
              aria-label="Predicted launch date for GTA 6"
              aria-describedby="date-help"
            />
            <label class="label">
              <span id="date-help" class="label-text-alt">Select a date between Jan 1, 2025 and Dec 31, 2125</span>
            </label>
          </div>

          <div id="validation-message" class="hidden" role="alert" aria-live="polite"></div>

          <!-- Turnstile widget container (invisible managed mode) -->
          <div id="turnstile-container"></div>

          <button
            type="submit"
            class="btn btn-primary w-full text-lg mt-4"
            aria-label="Add my prediction to the community"
          >
            Add My Prediction
          </button>
        </div>
      </form>
    </section>

    <!-- Error Display Section (Story 3.5: Error Handling with Retry Mechanisms) -->
    <!-- AC8: Red/orange color scheme, retry/dismiss buttons, clear next steps -->
    <section id="error-container" class="hidden mb-8" role="alert" aria-live="assertive" aria-atomic="true">
      <!-- Error content will be dynamically injected by errors.js -->
    </section>

    <!-- Submission Confirmation Section (Story 3.3: Submission Confirmation with Visual Feedback) -->
    <section id="confirmation-display" class="hidden mb-8" role="status" aria-live="polite" aria-labelledby="confirmation-heading">
      <h2 id="confirmation-heading" class="sr-only">Submission Confirmation</h2>

      <div class="card bg-success/10 shadow-xl border border-success/20">
        <div class="card-body items-center text-center">
          <!-- Success Icon (AC1: Green checkmark or celebration animation) -->
          <div id="confirmation-icon" class="mb-3" aria-hidden="true">
            <svg class="w-16 h-16 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>

          <!-- Primary Message (AC2) -->
          <p id="confirmation-primary" class="text-xl md:text-2xl font-bold text-success mb-2">
            Your prediction has been recorded!
          </p>

          <!-- Prediction Echo (AC3) -->
          <p id="confirmation-echo" class="text-base md:text-lg text-base-content mb-2">
            You predicted: <span id="confirmation-date" class="font-semibold">--</span>
          </p>

          <!-- Ranking Display (AC4) -->
          <p id="confirmation-ranking" class="text-base md:text-lg text-primary font-semibold">
            Your prediction #<span id="confirmation-rank">--</span>!
          </p>
        </div>
      </div>

      <!-- ARIA Live Region for Screen Reader Announcement (AC9: FR70) -->
      <div id="confirmation-announcement" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
    </section>

    <!-- Social Comparison Section (Story 3.2: Social Comparison Messaging) -->
    <!-- AC7: Positioned above share buttons (future) -->
    <section id="comparison-display" class="hidden mb-8" aria-labelledby="comparison-heading" aria-live="polite">
      <h2 id="comparison-heading" class="sr-only">How Your Prediction Compares</h2>

      <div class="card bg-gradient-to-br from-primary/5 to-secondary/5 shadow-xl border border-primary/10">
        <div class="card-body items-center text-center">
          <!-- Direction Emoji (AC3) -->
          <div id="comparison-emoji" class="text-5xl mb-2" aria-hidden="true">
            ðŸŽ¯
          </div>

          <!-- Primary Comparison Message (AC2) -->
          <p id="comparison-message" class="text-xl md:text-2xl font-bold text-base-content mb-2">
            You're exactly aligned with the community!
          </p>

          <!-- Personality Message (AC4) -->
          <p id="comparison-personality" class="text-base md:text-lg text-primary font-medium mb-3">
            Great minds think alike!
          </p>

          <!-- Quantified Delta (AC5, FR18) -->
          <p id="comparison-delta" class="text-sm text-base-content/70 mb-3">
            <span class="font-semibold">0 days</span> difference
          </p>

          <!-- Date Clarity (AC6: Both user date and median shown) -->
          <div class="divider text-xs text-base-content/40 my-2">Details</div>
          <div class="grid grid-cols-2 gap-4 w-full max-w-md text-sm">
            <div class="text-right">
              <p class="text-base-content/50 text-xs mb-1">Your Prediction</p>
              <p id="comparison-user-date" class="font-semibold text-base-content font-mono">--</p>
            </div>
            <div class="text-left">
              <p class="text-base-content/50 text-xs mb-1">Community Median</p>
              <p id="comparison-median-date" class="font-semibold text-base-content font-mono">--</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Cookie Consent Banner (Story 4.1: GDPR Cookie Consent Banner) -->
  <!-- AC: Bottom position, non-intrusive, two buttons, privacy link -->
  <aside id="cookie-consent-banner" class="hidden fixed bottom-0 left-0 right-0 z-50 bg-base-100 border-t-2 border-primary shadow-2xl" role="dialog" aria-labelledby="cookie-consent-heading" aria-describedby="cookie-consent-description" aria-live="polite">
    <div class="container mx-auto px-4 py-4 max-w-4xl">
      <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
        <!-- Content Section -->
        <div class="flex-1">
          <h2 id="cookie-consent-heading" class="text-lg font-bold text-base-content mb-2">
            We use cookies
          </h2>
          <p id="cookie-consent-description" class="text-sm text-base-content/80">
            We use functional cookies to save your prediction and analytics cookies to understand usage. You can opt out of analytics.
            <a href="/privacy" class="link link-primary ml-1" aria-label="Learn more about our privacy policy">Learn more</a>
          </p>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
          <button
            id="cookie-accept-all"
            type="button"
            class="btn btn-primary btn-sm"
            aria-label="Accept all cookies including analytics"
          >
            Accept All
          </button>
          <button
            id="cookie-functional-only"
            type="button"
            class="btn btn-outline btn-sm"
            aria-label="Accept only functional cookies, opt out of analytics"
          >
            Functional Only
          </button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Cloudflare Turnstile Badge (Required by Cloudflare ToS) -->
  <!-- Badge appears in bottom-right corner (AC: visible but non-intrusive) -->
  <footer class="fixed bottom-0 right-0 text-xs text-base-content/50 p-2">
    Protected by <a href="https://www.cloudflare.com/products/turnstile/" class="underline hover:text-primary" target="_blank" rel="noopener noreferrer">Cloudflare Turnstile</a>
  </footer>

  <script src="/js/comparison.js"></script>
  <script src="/js/submission.js" type="module"></script>
  <script src="/js/chart.js" type="module"></script>
  <script src="/js/degradation.js"></script>
  <script src="/js/cookie-consent.js"></script>
  <script src="/app.js?v=3.7.0"></script>
</body>
</html>
